# Drivers Hub: Backend

```
    ____       _                         __  __      __  
   / __ \_____(_)   _____  __________   / / / /_  __/ /_   
  / / / / ___/ / | / / _ \/ ___/ ___/  / /_/ / / / / __ \  
 / /_/ / /  / /| |/ /  __/ /  (__  )  / __  / /_/ / /_/ /  
/_____/_/  /_/ |___/\___/_/  /____/  /_/ /_/\__,_/_.___/  

```

**Features:**  
0.Multiple Drivers Hubs in one server process  
1.Asynchronous IO (database), making FastAPI really fast  
2.Generic authentication and rate limiting algorithm  
3.Discord / Steam / Password Login & MFA Support  
4.Role-based permission management  
5.Notification system (Drivers Hub & Discord)  
6.Multiple languages  

**Official Plugins**  
Announcement, Application, Banner, Challenge, Division, Downloads, Economy, Event, Tracker  

**External Plugins**  
External plugins can add new routes and background tasks to the existing app. It may also modify existing routes by using the same route path. For safety concerns, it's only allowed to modify data in `app.state`.  
To use an external plugin, place the `.py` file in `./external_plugins` folder, add the name of the file to `config.external_plugins` and it'll be automatically loaded.  
To create an external plugin, create a `.py` with `init` function and some route functions. The `init` function must take `app` and `first_init: bool = False` (log should only be written when `first_init = True`) as the only arguments (`def init(app, first_init = False)`) and return `True` (It will not be loaded if `True` is not returned). It will be called when the plugin is loaded. It must modify `app.state.external_routes` to create new routes / modify existing routes. Reference: [example.py](./src/external_plugins/example.py).  

**About Banner**  
To save memory when running multiple Drivers Hub, banners are generated by `bannergen` in a separate process. It must be running so that banner function could work.  

**Security API**  
1.Authorization  
`await auth(authorization, request, allow_application_token = False, check_member = True, required_permission = ["admin", "driver"])`  
returns `{error: bool, discordid: int, userid: int, name: str, roles: list, application_token: bool}`  
2.Rate limit  
`await ratelimit(request, endpoint, limittime, limitcnt)`  
When rate limited, returns `(True, JSONResponse)`  
When not rate limited, returns `(False, resp_headers: dict)`  

**More Info?**  
Please refer to the [wiki](https://wiki.charlws.com)  
For API documentation, please use [openapi.json](./openapi.json)  

&copy; 2023 [CharlesWithC](https://charlws.com)  
